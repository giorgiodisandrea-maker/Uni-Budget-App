<!DOCTYPE html>
<html>
<head>
  <title>Uni Budget Calculator</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Firebase (compat SDK â€“ correct for plain HTML + GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBnn-u991pW4m3En3AlmpIPCplZ9ev4TOA",
      authDomain: "uni-budget-app.firebaseapp.com",
      projectId: "uni-budget-app",
      storageBucket: "uni-budget-app.firebasestorage.app",
      messagingSenderId: "807550470586",
      appId: "1:807550470586:web:09c16fa0fe008653917583"
    };

    firebase.initializeApp(firebaseConfig);
    window.auth = firebase.auth(); // make auth global
  </script>
</head>

<body>
  <div class="container">

    <!-- LOGIN -->
    <button onclick="loginWithGoogle()">Sign in with Google</button>
    <p id="user-status">Not signed in</p>

    <h1>Uni Budget Calculator</h1>

    <p>Student loan (per year):</p>
    <input id="loan" type="number">

    <p>Monthly wage:</p>
    <input id="wage" type="number">

    <p>Personal funds:</p>
    <input id="personal" type="number">

    <p>Monthly subscriptions (Â£):</p>
    <input id="subscriptions" type="number" placeholder="Netflix, Spotify, gym">

    <p>Select your university:</p>
    <select id="uni"></select>

    <p>Food preference:</p>
    <select id="food">
      <option value="25">Bare minimum (Â£25/week)</option>
      <option value="40">Balanced (Â£40/week)</option>
      <option value="60">Premium (Â£60/week)</option>
    </select>

    <p>Nights out per week:</p>
    <input id="nights" type="number">

    <button onclick="calculateBudget()">Calculate</button>

    <h2 id="result"></h2>
    <p id="tips"></p>

  </div>

  <script>
    /* ---------- AUTH ---------- */
    function loginWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .catch(err => alert(err.message));
    }

    auth.onAuthStateChanged(user => {
      document.getElementById("user-status").innerText =
        user ? "Signed in as " + user.displayName : "Not signed in";
    });

    /* ---------- DATA ---------- */
    let universities = [];
    let cityCosts = {};

    Promise.all([
      fetch("universities.json").then(r => r.json()),
      fetch("cityCosts.json").then(r => r.json())
    ]).then(([uniData, cityData]) => {
      universities = uniData;
      cityCosts = cityData;

      const uniSelect = document.getElementById("uni");
      universities.forEach((u, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = u.name;
        uniSelect.appendChild(option);
      });
    });

    /* ---------- CALCULATOR ---------- */
    function calculateBudget() {
      let loan = Number(loanInput.value);
      let wage = Number(wageInput.value);
      let personal = Number(personalInput.value);
      let subscriptions = Number(subscriptionsInput.value);
      let nights = Number(nightsInput.value);

      let weeklyIncome =
        loan / 52 +
        wage / 4 +
        personal / 52;

      let weeklySubscriptions = subscriptions / 4;

      let selectedUni = universities[uni.value];
      let uniNightCost = cityCosts[selectedUni.city];

      let weeklyBalance =
        weeklyIncome -
        (nights * uniNightCost) -
        Number(food.value) -
        weeklySubscriptions;

      let message =
        weeklyBalance < 0 ? "ðŸ”´ You are overspending." :
        weeklyBalance < 30 ? "ðŸŸ  Tight budget." :
        "ðŸŸ¢ Safe budget.";

      result.innerText =
        message + " Weekly balance: Â£" + weeklyBalance.toFixed(2);

      /* ---------- TIPS ---------- */
      let tipsText = "";

      if (weeklySubscriptions > 10) {
        tipsText +=
          "â€¢ Cancelling unused subscriptions could save Â£" +
          weeklySubscriptions.toFixed(2) + " per week.<br>";
      }

      if (nights > 0) {
        tipsText +=
          "â€¢ One fewer night out saves Â£" + uniNightCost + " per week.<br>";
      }

      tips.innerHTML =
        weeklyBalance < 30 && tipsText !== ""
          ? "ðŸ’¡ <strong>Money-saving tips:</strong><br>" + tipsText
          : "";
    }

    /* ---------- SHORTCUTS ---------- */
    const loanInput = document.getElementById("loan");
    const wageInput = document.getElementById("wage");
    const personalInput = document.getElementById("personal");
    const subscriptionsInput = document.getElementById("subscriptions");
    const nightsInput = document.getElementById("nights");
    const uni = document.getElementById("uni");
    const food = document.getElementById("food");
    const result = document.getElementById("result");
    const tips = document.getElementById("tips");
  </script>
</body>
</html>
