<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Univio â€“ Student Budgeting</title>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Firebase (compat SDK for plain HTML) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBnn-u991pW4m3En3AlmpIPCplZ9ev4TOA",
      authDomain: "uni-budget-app.firebaseapp.com",
      projectId: "uni-budget-app",
      storageBucket: "uni-budget-app.firebasestorage.app",
      messagingSenderId: "807550470586",
      appId: "1:807550470586:web:09c16fa0fe008653917583"
    };

    firebase.initializeApp(firebaseConfig);
    window.auth = firebase.auth();
  </script>
</head>

<body>

  <!-- TOP BAR (LOGO ALWAYS TOP-LEFT) -->
  <header class="topbar">
    <div class="brand">
      <img src="logo.svg" alt="Univio logo" class="logo-img">
      <span class="brand-name">Univio</span>
    </div>

    <nav class="nav">
      <button class="nav-link active" data-page="home">Home</button>
      <button class="nav-link" data-page="calculator">Calculate</button>
      <button class="nav-link" data-page="account">Account</button>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="shell">

    <!-- HOME PAGE -->
    <section id="page-home" class="page active">
      <div class="card">
        <h1>Student budgeting, simplified.</h1>
        <p class="muted">
          Univio helps you plan weekly spending using your loan, income,
          subscriptions, and university city costs.
        </p>

        <div class="home-actions">
          <button class="primary" id="go-calc">Calculate my budget</button>
          <button class="secondary" id="go-account">Sign in</button>
        </div>
      </div>
    </section>

    <!-- CALCULATOR PAGE -->
    <section id="page-calculator" class="page">
      <div class="card">
        <h1>Calculate budget</h1>
        <p class="muted">Weekly estimate based on your inputs.</p>

        <div class="form">
          <label>
            <span>Student loan (per year)</span>
            <input id="loan" type="number">
          </label>

          <label>
            <span>Monthly wage</span>
            <input id="wage" type="number">
          </label>

          <label>
            <span>Personal funds</span>
            <input id="personal" type="number">
          </label>

          <label>
            <span>Monthly subscriptions</span>
            <input id="subscriptions" type="number">
          </label>

          <label>
            <span>University</span>
            <select id="uni"></select>
          </label>

          <label>
            <span>Food preference</span>
            <select id="food">
              <option value="25">Bare minimum (Â£25/week)</option>
              <option value="40">Balanced (Â£40/week)</option>
              <option value="60">Premium (Â£60/week)</option>
            </select>
          </label>

          <label>
            <span>Nights out per week</span>
            <input id="nights" type="number">
          </label>

          <button class="primary" onclick="calculateBudget()">Calculate</button>

          <div id="result" class="output"></div>
          <div id="tips" class="output tips"></div>
        </div>
      </div>
    </section>

    <!-- ACCOUNT PAGE -->
    <section id="page-account" class="page">
      <div class="card">
        <h1>Account</h1>
        <p class="muted">Sign in to manage your budget.</p>

        <p id="user-status" class="muted">Not signed in</p>

        <div class="account-actions">
          <button class="primary" onclick="loginWithGoogle()">Sign in with Google</button>
          <button class="secondary" onclick="logout()" id="logoutBtn" style="display:none;">
            Sign out
          </button>
        </div>
      </div>
    </section>

  </main>

  <!-- SCRIPTS -->
  <script>
    /* AUTH */
    function loginWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(e => alert(e.message));
    }

    function logout() {
      auth.signOut();
    }

    auth.onAuthStateChanged(user => {
      const status = document.getElementById("user-status");
      const logoutBtn = document.getElementById("logoutBtn");

      if (user) {
        status.innerText = "Signed in as " + user.displayName;
        logoutBtn.style.display = "inline-block";
      } else {
        status.innerText = "Not signed in";
        logoutBtn.style.display = "none";
      }
    });

    /* DATA */
    let universities = [];
    let cityCosts = {};

    Promise.all([
      fetch("universities.json").then(r => r.json()),
      fetch("cityCosts.json").then(r => r.json())
    ]).then(([u, c]) => {
      universities = u;
      cityCosts = c;

      const uniSelect = document.getElementById("uni");
      universities.forEach((uni, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = uni.name;
        uniSelect.appendChild(opt);
      });
    });

    /* CALCULATOR */
    function calculateBudget() {
      const loan = Number(loan.value) || 0;
      const wage = Number(wage.value) || 0;
      const personal = Number(personal.value) || 0;
      const subs = Number(subscriptions.value) || 0;
      const nightsOut = Number(nights.value) || 0;

      const weeklyIncome = loan / 52 + wage / 4 + personal / 52;
      const weeklySubs = subs / 4;

      const uniObj = universities[uni.value];
      if (!uniObj) return;

      const nightCost = cityCosts[uniObj.city] || 0;
      const foodCost = Number(food.value) || 0;

      const balance =
        weeklyIncome - (nightsOut * nightCost) - foodCost - weeklySubs;

      result.innerText =
        (balance < 0 ? "ðŸ”´ Overspending" :
         balance < 30 ? "ðŸŸ  Tight budget" :
         "ðŸŸ¢ Safe budget") +
        " â€“ Weekly balance Â£" + balance.toFixed(2);

      tips.innerHTML =
        balance < 30
          ? "ðŸ’¡ Reduce nights out or subscriptions to improve balance."
          : "";
    }

    /* NAVIGATION */
    const pages = ["home", "calculator", "account"];
    document.querySelectorAll(".nav-link").forEach(btn => {
      btn.addEventListener("click", () => showPage(btn.dataset.page));
    });

    function showPage(p) {
      pages.forEach(x =>
        document.getElementById("page-" + x).classList.toggle("active", x === p)
      );
      document.querySelectorAll(".nav-link").forEach(b =>
        b.classList.toggle("active", b.dataset.page === p)
      );
      window.scrollTo(0, 0);
    }

    document.getElementById("go-calc").onclick = () => showPage("calculator");
    document.getElementById("go-account").onclick = () => showPage("account");
  </script>

</body>
</html>


