<!DOCTYPE html>
<html>
<head>
  <button onclick="loginWithGoogle()">Sign in with Google</button>
<p id="user-status"></p>
  <title>Uni Budget Calculator</title>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyBnn-u991pW4m3En3AlmpIPCplZ9ev4TOA",
    authDomain: "uni-budget-app.firebaseapp.com",
    projectId: "uni-budget-app",
    storageBucket: "uni-budget-app.firebasestorage.app",
    messagingSenderId: "807550470586",
    appId: "1:807550470586:web:09c16fa0fe008653917583",
    measurementId: "G-RH28G8QL65"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
</script>
</head>
<link rel="stylesheet" href="style.css">
<body>
 <div class="container">
    <!-- all your existing HTML goes here -->
  </div>
</body>
<h1>Uni Budget Calculator</h1>

<p>Student loan (per year):</p>
<input id="loan" type="number">

<p>Monthly wage:</p>
<input id="wage" type="number">

<p>Personal funds:</p>
<input id="personal" type="number">

<p>Select your university:</p>
<select id="uni"></select>

<p>Food preference:</p>
<select id="food">
  <option value="25">Bare minimum (Â£25/week)</option>
  <option value="40">Balanced (Â£40/week)</option>
  <option value="60">Premium (Â£60/week)</option>
</select>

<p>Nights out per week:</p>
<input id="nights" type="number">

<br><br>
<button onclick="calculateBudget()">Calculate</button>

<h2 id="result"></h2>
<p id="tips"></p>

<script>
function loginWithGoogle() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user => {
  if (user) {
    document.getElementById("user-status").innerText =
      "Signed in as " + user.displayName;
  } else {
    document.getElementById("user-status").innerText =
      "Not signed in";
  }
});

let universities = [];
let cityCosts = {};

// Load university + city cost data
Promise.all([
  fetch("universities.json").then(res => res.json()),
  fetch("cityCosts.json").then(res => res.json())
]).then(([uniData, cityData]) => {
  universities = uniData;
  cityCosts = cityData;

  const uniSelect = document.getElementById("uni");

  universities.forEach((u, index) => {
    const option = document.createElement("option");
    option.value = index;
    option.textContent = u.name;
    uniSelect.appendChild(option);
  });
});

// Main calculation
function calculateBudget() {
  let loan = Number(document.getElementById("loan").value);
  let wage = Number(document.getElementById("wage").value);
  let personal = Number(document.getElementById("personal").value);
  let nights = Number(document.getElementById("nights").value);

  let weeklyLoan = loan / 52;
  let weeklyWage = wage / 4;
  let weeklyPersonal = personal / 52;

  let weeklyIncome = weeklyLoan + weeklyWage + weeklyPersonal;

  let selectedUni = universities[document.getElementById("uni").value];
  let uniNightCost = cityCosts[selectedUni.city];

  let nightOutCost = nights * uniNightCost;
  let foodCost = Number(document.getElementById("food").value);

  let weeklyBalance = weeklyIncome - nightOutCost - foodCost;

  let message = "";

  if (weeklyBalance < 0) {
    let weeklyLoss = Math.abs(weeklyBalance);
    let savings = loan + personal;
    let weeksLeft = Math.floor(savings / weeklyLoss);
    message = "ðŸ”´ Warning: You will run out of money in about " + weeksLeft + " weeks.";
  } else if (weeklyBalance < 30) {
    message = "ðŸŸ  Tight budget: you have little room for error.";
  } else {
    message = "ðŸŸ¢ Safe budget: you should be okay.";
  }

  document.getElementById("result").innerText =
    message + " Weekly balance: Â£" + weeklyBalance.toFixed(2);

  // Money-saving tips
  let tips = "";

  if (nights > 0) {
    tips += "â€¢ 1 fewer night out saves Â£" + uniNightCost + " per week.<br>";
  }

  if (foodCost > 25) {
    let cheaperFood = foodCost === 60 ? 40 : 25;
    tips += "â€¢ Switching to cheaper food saves Â£" + (foodCost - cheaperFood) + " per week.<br>";
  }

  if (weeklyBalance < 30 && tips !== "") {
    document.getElementById("tips").innerHTML =
      "ðŸ’¡ <strong>Money-saving tips:</strong><br>" + tips;
  } else {
    document.getElementById("tips").innerHTML = "";
  }
}
</script>

</body>
</html>
